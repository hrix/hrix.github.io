title: 最近のインフラエンジニアの仕事
date: 2014-11-12 15:58:45
tags:
---

Web制作の会社のプロダクト部の平井です。部では二名いるインフラ担当の一人です

インフラ担当って何をやっているのか？　少し分かりにくいのと、新しいことも取り入れながらやっていっていますので、仕事のご紹介したいと思います。


## インフラエンジニアとは？
仕事として分けると大きく二つ、
* サーバ構築
* 日々の運用
があります。
前者は、新しいサーバの立ち上げ、後者は、稼働中のサーバの監視、メンテナンス、トラブル対応、セキュリティ対策になります

今までこれらを手を動かして作業している部分が大きかったのですが、少しづつプログラム開発のようなコード化を進めていっているのでそちらを紹介します。

## インフラのコード化ついて
以前、もう一人のインフラ担当が以下のような事例紹介を発表しました。
> インフラ構築の自動化・量産化。e-Agencyのクラウドプロダクト部における Chef 導入事例を紹介  
> http://www.e-agency.co.jp/column/20140724.html  

どれくらい大変なのか、その後どのように実践していったか、途中経過をお知らせします。

### コード化の実践状況

 以前の手作業と、コード化作業との比較ですが、以下のような特徴があり、インフラチームのエンジニアと情報共有がグンと進んで来ているのを実感できています。

* 一度作った手順（レシピ）をリポジトリ（Githubなど）に置いて再利用ができる
* どういう設定をしたか、いちいちサーバに入って確認しなくてよい（記憶に頼らなくてよい、メモの漏れも気にしなくて良い）といったメリットがあります。反面
* レシピを書かないといけないので、最初は手で立ち上げるよりかは時間がかかる。

「サーバ構築」を新規で行う場合は原則、Chefで構築したものを投入するようにしています。
具体的には主にミドルウエア（Apache, Nginx, MySQL, Ruby, PHPなど）のインストールを今まで手作業でやっていたものをChefに置き換えています。  

「日々の運用」の監視部分はNagios, Muninといったツールをカスタマイズして使っています。これらの設定ファイルはGithubで履歴管理をしています。またときどき発生するログインしてメンテナンスする場合です。サーバ台数が100台以上になってきて、こちらも手作業が辛くなってきているので、ansibleというツールを使っています。こちらも手順がコード化できます。  
ansibleはchefとできることがかぶるツールではあるのですが、Chefと違って手作業でインストールしたサーバに対しても簡単に適用できるということで、既存のサーバも含めてやる作業に使っています。

* Chefはきちんと整理して共有しやすくしてくれるツール。ansibleは運用を楽にしてくれるツールという使い分けになります。
* 手でも同じことをやったことのある経験があった方が、これらのツールになじみやすいと思います。（いざというとき手でも対応できますし）


### コード化のこれから
　インフラ業務をプログラマと同じように全てコード化できると、開発と運用がより近づき、今までよりレベルの上がった世界にいけると感じています。

　しかし上記以外にもまだコード化に手をつけられていない部分があります。


### コード化できていない部分
　サーバ構築の初期のマシン構築（サーバの起動、OSインストール、ネットワークの設定など）をコード化するにはいくつか、課題があります。

　まず、我々はサーバベンダーの選定はどこかに固定はしていません。固定するとコード化はしやすくなりますが、それよりもサーバの種類によってベンダーも使い分け（コーヒーで言うとブレンド）のメリットを感じています。

* クラウド→これがメインになりつつあります
* VPS→テスト、監視用サーバなどクリティカルではないもの（安く済ませられるというメリット）
* 専用サーバ→クリティカルなもの、特殊な設定が必要なもの
* オンプレミス（ラック借り）→最近はなくなりつつあります
を場所に応じて使い分けています。
　DNSのレコード管理はDNSのAWSのRoute53を使えば、比較的簡単にできますが上記と関連があるのであえてまだやっていません。

　またトラブル対応やセキュリティ対策、インフラのテストもこれから改善していきたい課題になります。


### まとめ
　インフラチームも開発と一緒になって生産性を上げていきたいと思っています。  
　何となくでも理解していただけると幸いです。

